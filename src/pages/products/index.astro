---
import Layout from "@/layouts/Layout.astro";
import Container from "@/components/container.astro";
import { Icon } from "astro-icon/components";
import Breadcrumbs from "@/components/ui/Breadcrumbs.astro";

// å•†å“ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
import productsData from "@/data/products.json";
const products = productsData.products || [];

// ã‚¿ã‚°ã‹ã‚‰é‡è¤‡ã‚’é™¤ã„ã¦ã‚«ãƒ†ã‚´ãƒªã‚’ç”Ÿæˆ
const allTags = new Set<string>();
products.forEach(product => {
  product.tags?.forEach(tag => allTags.add(tag));
});
const categories = ["ã™ã¹ã¦", ...Array.from(allTags).slice(0, 10)];
---

<Layout title="å•†å“ä¸€è¦§">
  <div class="page-header">
    <Container>
      <Breadcrumbs items={[{ label: "ãƒ›ãƒ¼ãƒ ", href: "/" }, { label: "å•†å“ä¸€è¦§", href: "/products" }]} />
      <h1 class="page-title">å•†å“ä¸€è¦§</h1>
      <p class="page-description">
        ã€Œã¿ã‚“ãªVRã§ãŸã®ã—ããã‚‰ãã†ã€ã‚’æ”¯ãˆã‚‹ã€<br />
        ã™ã¹ã¦å®Ÿéš›ã®ã‚¤ãƒ™ãƒ³ãƒˆã€ŒKemonoBarãšã‚“ã©ã“ã€ã§å®Ÿè¨¼æ¸ˆã¿ã®è»½é‡ã‚¢ã‚»ãƒƒãƒˆã§ã™ã€‚
      </p>
    </Container>
  </div>

  <Container>
    <!-- Filter and Search -->
    <div class="filter-section">
      <div class="filter-tags">
        {categories.map((category) => (
          <button class={`filter-tag ${category === "ã™ã¹ã¦" ? "active" : ""}`}>
            {category}
          </button>
        ))}
      </div>
      <div class="search-box">
        <Icon name="mdi:magnify" class="search-icon" />
        <input type="text" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢" class="search-input" />
      </div>
    </div>

    <!-- Products Grid -->
    <div class="products-grid">
      {products.map((product) => (
        <div class="product-card" data-tags={JSON.stringify(product.tags)}>
          <a href={`/products/${product.id}`} class="product-link">
            <div class="product-image">
              {product.main_image ? (
                <img src={product.main_image} alt={product.name} class="product-thumbnail" />
              ) : (
                <div class="placeholder-image">
                  <Icon name="mdi:package-variant" class="placeholder-icon" />
                </div>
              )}
            </div>
            <div class="product-info">
              <h3 class="product-name">{product.name}</h3>
              {product.min_price && (
                <p class="product-price">Â¥{product.min_price.toLocaleString()}ã€œ</p>
              )}
              {product.published_at && (
                <p class="product-date">ğŸ“… {product.published_at}</p>
              )}
              <div class="product-tags">
                {product.tags?.slice(0, 3).map(tag => (
                  <span class="product-tag">{tag}</span>
                ))}
              </div>
              <div class="product-actions">
                <span class="btn-detail">è©³ç´°ã‚’è¦‹ã‚‹</span>
                {product.booth_url && (
                  <a href={product.booth_url} target="_blank" rel="noopener noreferrer" class="btn-booth" onclick="event.stopPropagation()">
                    <Icon name="mdi:shopping" class="btn-icon" />
                    Booth
                  </a>
                )}
              </div>
            </div>
          </a>
        </div>
      ))}
    </div>

    <!-- CTA Section -->
    <div class="cta-section">
      <h2 class="cta-title">å•†å“ã«é–¢ã™ã‚‹ã”è³ªå•ãƒ»ã”è¦æœ›</h2>
      <p class="cta-description">
        å°å…¥æ–¹æ³•ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã€ä¸å…·åˆãªã©ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚
      </p>
      <a href="/support/contact" class="cta-button">
        <Icon name="mdi:email" class="cta-icon" />
        ãŠå•ã„åˆã‚ã›
      </a>
    </div>
  </Container>
</Layout>

<style>
  .page-header { text-align: center; padding: 1.5rem 0 3rem; }
  .page-title { font-size: clamp(2.5rem, 6vw, 4rem); font-weight: 900; margin-bottom: 1rem; color: var(--main-color); }
  .page-description { font-size: clamp(1rem, 2vw, 1.25rem); color: var(--sub-color); line-height: 1.8; }
  .filter-section { display: flex; justify-content: space-between; align-items: center; gap: 2rem; margin-bottom: 3rem; flex-wrap: wrap; }
  .filter-tags { display: flex; gap: 0.75rem; flex-wrap: wrap; }
  .filter-tag { padding: 0.5rem 1.25rem; border: 2px solid var(--main-color); border-radius: 2rem; background: white; color: var(--sub-color); font-weight: 700; cursor: pointer; transition: all 0.3s ease; }
  .filter-tag:hover, .filter-tag.active { background: var(--main-color); color: white; }
  .search-box { position: relative; display: flex; align-items: center; }
  .search-icon { position: absolute; left: 1rem; width: 1.25rem; height: 1.25rem; color: var(--sub-color); opacity: 0.5; }
  .search-input { padding: 0.75rem 1rem 0.75rem 3rem; border: 2px solid var(--main-color); border-radius: 2rem; font-size: 1rem; min-width: 300px; background: white; color: var(--sub-color); }
  
  .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 2rem; margin-bottom: 4rem; }
  
  .product-card { background: white; border-radius: 2rem; border: 3px solid var(--main-color); overflow: hidden; transition: all 0.3s ease; }
  .product-card:hover { transform: translateY(-8px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); }
  
  .product-link { text-decoration: none; color: inherit; display: block; }
  
  /* æ­£æ–¹å½¢ã®ã‚µãƒ ãƒã‚¤ãƒ« */
  .product-image { 
    position: relative; 
    width: 100%; 
    padding-bottom: 100%; /* 1:1ã®ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯” */
    background: var(--bg-color); 
    border-bottom: 3px solid var(--main-color);
    overflow: hidden;
  }
  
  .product-thumbnail {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .placeholder-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .placeholder-icon { width: 6rem; height: 6rem; color: var(--main-color); opacity: 0.3; }
  
  .product-info { padding: 1.5rem; }
  .product-name { 
    font-size: 1.25rem; 
    font-weight: 900; 
    margin-bottom: 0.75rem; 
    color: var(--sub-color);
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .product-price {
    font-size: 1.5rem;
    font-weight: 900;
    color: var(--main-color);
    margin-bottom: 0.5rem;
  }
  
  .product-date {
    font-size: 0.875rem;
    color: var(--sub-color);
    opacity: 0.7;
    margin-bottom: 1rem;
  }
  
  .product-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-bottom: 1.5rem;
  }
  
  .product-tag {
    font-size: 0.75rem;
    padding: 0.25rem 0.75rem;
    background: var(--bg-color);
    color: var(--sub-color);
    border-radius: 1rem;
    font-weight: 700;
  }
  
  .product-actions { display: flex; gap: 1rem; }
  .btn-detail, .btn-booth { 
    flex: 1; 
    padding: 0.75rem; 
    border-radius: 1rem; 
    font-weight: 900; 
    text-align: center; 
    text-decoration: none; 
    transition: all 0.3s ease; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    gap: 0.5rem; 
  }
  .btn-detail { border: 2px solid var(--main-color); color: var(--main-color); background: white; }
  .btn-detail:hover { background: var(--main-color); color: white; }
  .btn-booth { background: var(--main-color); color: white; border: 2px solid var(--main-color); }
  .btn-booth:hover { box-shadow: 0 8px 16px rgba(0,0,0,0.2); }
  
  .cta-section { background: var(--main-color); color: white; padding: 4rem; border-radius: 2rem; text-align: center; margin-bottom: 4rem; border: 3px solid var(--sub-color); }
  .cta-title { font-size: 2rem; font-weight: 900; margin-bottom: 1rem; }
  .cta-button { display: inline-flex; align-items: center; gap: 0.75rem; background: white; color: var(--main-color); padding: 1rem 2.5rem; border-radius: 3rem; font-weight: 900; text-decoration: none; margin-top: 2rem; }
  
  @media (max-width: 768px) { 
    .filter-section { flex-direction: column; align-items: stretch; } 
    .search-input { min-width: auto; }
    .products-grid { grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); }
  }
</style>